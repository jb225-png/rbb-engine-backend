from sqlalchemy.orm import Session\nfrom app.models.generation_job import GenerationJob\nfrom app.models.product import Product\nfrom app.core.enums import JobStatus, ProductStatus\nfrom app.utils.logger import logger\n\ndef update_job_status(db: Session, job_id: int) -> None:\n    \"\"\"Update generation job status based on associated products\"\"\"\n    job = db.query(GenerationJob).filter(GenerationJob.id == job_id).first()\n    if not job:\n        return\n    \n    # Count products by status\n    products = db.query(Product).filter(Product.generation_job_id == job_id).all()\n    \n    total = len(products)\n    completed = sum(1 for p in products if p.status == ProductStatus.GENERATED)\n    failed = sum(1 for p in products if p.status == ProductStatus.FAILED)\n    \n    # Update job tracking fields\n    job.total_products = total\n    job.completed_products = completed\n    job.failed_products = failed\n    \n    # Update job status based on product states\n    if total == 0:\n        job.status = JobStatus.PENDING\n    elif failed > 0 and completed == 0:\n        job.status = JobStatus.FAILED\n    elif completed == total:\n        job.status = JobStatus.COMPLETED\n    elif completed > 0 or failed > 0:\n        job.status = JobStatus.RUNNING\n    else:\n        job.status = JobStatus.PENDING\n    \n    db.commit()\n    logger.info(f\"Updated job {job_id} status to {job.status} ({completed}/{total} completed, {failed} failed)\")