# RBB Engine - Day 3 API Stabilization\n\n## Generate Product Flow (Finalized)\n\n### `POST /api/generate-product`\n- **Purpose**: Create generation job and product records atomically\n- **Validation**: \n  - `standard_id` must be positive integer\n  - `grade_level` must be 1-12\n  - All required fields validated\n- **Transaction Safety**: Uses database transactions for atomic operations\n- **Storage**: Creates stub files (JSON, PDF, thumbnail) automatically\n- **Response**: \n```json\n{\n  \"job_id\": 1,\n  \"product_ids\": [1],\n  \"message\": \"Product generation job created successfully for WORKSHEET\"\n}\n```\n\n## Generation Job Status Tracking\n\n### Automatic Status Updates\n- Jobs track: `total_products`, `completed_products`, `failed_products`\n- Status updated when product status changes:\n  - `PENDING`: No products processed\n  - `RUNNING`: Some products completed/failed\n  - `COMPLETED`: All products generated successfully\n  - `FAILED`: All products failed, none completed\n\n### Status Rules\n- Job status automatically calculated from product states\n- Consistent tracking across all job operations\n- No manual job status updates required\n\n## Upload Task Lifecycle (Finalized)\n\n### Status Transitions\n- `PENDING` → `IN_PROGRESS` (VA starts work)\n- `IN_PROGRESS` → `COMPLETED` (VA finishes)\n- `IN_PROGRESS` → `PENDING` (VA pauses/reassigns)\n- `COMPLETED` is terminal state\n\n### Validation\n- Invalid transitions return 400 error\n- Clear error messages for transition violations\n- Assignment tracking with `assigned_to` field\n\n## Error Handling Standards\n\n### HTTP Status Codes\n- `400`: Validation errors, invalid transitions\n- `404`: Resource not found\n- `500`: Database errors, internal failures\n\n### Response Format\n- Consistent error messages\n- No internal error exposure\n- Proper logging for debugging\n\n### Transaction Safety\n- Database transactions for multi-record operations\n- Rollback on any failure\n- Atomic job + product creation\n\n## Storage & Stub Files\n\n### Automatic Creation\n- Product directories created on job generation\n- Stub files: `raw.json`, `final.json`, `metadata.json`\n- Placeholder PDF and thumbnail files\n- Organized directory structure for ZIP bundles\n\n### Error Resilience\n- Storage failures don't break job creation\n- Warnings logged for storage issues\n- Database operations remain atomic\n\n## Ready for Frontend Integration\n\n### Stable APIs\n- All endpoints handle errors gracefully\n- Consistent validation and responses\n- Transaction safety for data integrity\n- Proper status tracking and transitions\n\n### Next Phase Preparation\n- TODOs marked for automation work\n- Clean separation of concerns\n- Ready for AI logic integration\n- Background job hooks prepared", "oldStr": ""}]